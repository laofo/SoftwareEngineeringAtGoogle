## 2.8 发布工程

只有一部分团队有专门的发布工程师，但对于Google的大多数团队来说，发布工程工作由常规软件工程师完成。

大多数软件经常发布;每周或每两周发布一次是常见的，有些团队甚至每天发布。这是通过自动化大部分正常的发布工程任务实现的。经常发布有助于保持工程师的积极性（如果许多个月甚至几年后才发布，很难被认为是激动人心的事），通过允许更多的迭代从而增加整体速度，因而在给定的时间越多的反馈带来越多响应反馈的机会。

发布通常在新的工作区中开始，通过同步到最新的“绿色”构建的变更号（即，所有自动测试通过的最后一个变更），并产生一个发布分支。发布工程师可以选择“最优选择”的额外变更，即从主分支合并到发布分支上。然后从草稿重建软件并执行测试。如果有任何失败的测试，则进行变更以修复缺陷并且让那些额外的变更在发布分支上达到最优，之后再次进行软件重建和测试重运行。当测试全部通过，构建的可执行文件和数据文件被打包。所有这些步骤都是自动的，以便发布工程师只需运行一些简单的命令，甚至只需在菜单驱动的UI上选择一些条目并选择那些最优变更（如果有）。

一旦候选构建被打包，它通常被加载到“预演staging”服务器上做进一步通过少量用户的集成测试（有时只是开发团队）。

一种发送来自生产流量的请求副本（或子集）到预演服务器的有用技术，但也将这些相同的请求发送到当前生产服务器用于实际处理。来自预演服务器的响应被丢弃，并且从实际生产服务器的响应发回给用户。这有助于确保任何可能会导致严重的问题（例如服务器崩溃）在服务器投入生产之前可以被检测到。

下一步通常是推出一个或多个“公测canary”服务器来处理一小部分实时生产流量。与“预演”服务器不同，这些是处理和响应是真实的用户。

最后，该版本可以推广到所有数据中心中的所有服务器。对于超高流量，高可靠性的服务，这种逐步推出在几天的时间内完成，有助于减少任何运行中断的影响，因为新引入的缺陷没有被前面的步骤捕获。

有关Google发布工程的更多信息，请参见SRE手册[7]的第8章。也可以参见[15]。

